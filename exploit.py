import struct
import ctypes
import os
import sys
from tkinter import *
from PIL import Image, ImageDraw, ImageFont
from tkinter import filedialog as fd
from tkinter import colorchooser


SPI_SETDESKWALLPAPER = 20

widht = ctypes.windll.user32.GetSystemMetrics(0)
height = ctypes.windll.user32.GetSystemMetrics(1)
url = os.path.abspath(__file__)
is_text = False
is_font = False
Font = "arial.ttf"
color = ((255,255,255), None)
Size="32"
command= ""
get_cound_data = 0

def resource_path(relative):
    if hasattr(sys, "_MEIPASS"):
        return os.path.join(sys._MEIPASS, relative)
    return os.path.join(relative)

path = resource_path('icon.ico')



def is_64bit_windows():
    return struct.calcsize('P') * 8 == 64

def change(path):
    if is_64bit_windows():
        ctypes.windll.user32.SystemParametersInfoW(SPI_SETDESKWALLPAPER, 0, path, 3)
    else:
        ctypes.windll.user32.SystemParametersInfoA(SPI_SETDESKWALLPAPER, 0, path, 3)

def text(TEXT):
    global color, Font, Size
    im = Image.new('RGB', (widht,height), color=('#000000'))
    font = ImageFont.truetype(Font, int(Size), encoding='UTF-8')
    print(color[0])
    draw_text = ImageDraw.Draw(im)
    draw_text.text(
        (widht/2,height/2),
        TEXT,
        color[0],
        font = font
        )
    im.save(url+"EXPLOIT_8979.png")
    change(url+"EXPLOIT_8979.png")
    os.remove(url+"EXPLOIT_8979.png")
def click():
    global is_text, is_font, Font,command, get_cound_data, Size, txt
    word = txt.get()
    if txt.get() == "!txtBG":
        is_text = True
        lbl.configure(text='ведите текст \nесли ты хочешь вернуться пропишите команду !imBG\nесли хочешь изменить шрифт то пропиши !Fназвание шрифта.tff\n сли хочешь изменить размер шрифта то пропиши !Sразмер\nесли нечего небудет заполнено то выведет текст\n"ПРИВЕТ МИР!!! IT`S BG EXPLOIT :)"')
        openFile.configure(text='изменить цвет')
    elif txt.get() == "!imBG":
        is_text = False
        lbl.configure(text='Привет, ты нашел секретный exploit по взлому фона рабочего стола\nведи адрес картинки или напиши команду !txtBG\nесли нечего небудет заполнено то выведет текст\n"ПРИВЕТ МИР!!! IT`S BG EXPLOIT :)"')
        openFile.configure(text='открыть файл')
    elif txt.get() == "":
        text("ПРИВЕТ МИР!!! IT`S BG EXPLOIT :)")
    elif word[0] == "!":
        if word[1] == "F":
            for i in word:
                if (get_cound_data <= 1):
                    pass
                else:
                    command = command+ i
                get_cound_data += 1
            Font = command
        if word[1] == "S":
            for i in word:
                if (get_cound_data <= 1):
                    pass
                else:
                    command = command+ i
                get_cound_data += 1
            Size = command

            try:
                int(Size)
            except ValueError:
                print("error")
        get_cound_data = 0
        command = ""
    
    else:
        if is_text:
            text(txt.get())
        else:
            change(txt.get())
    txt.delete(0, END)
    
def openfileClick():
    global color
    if not(is_text):
        image = fd.askopenfilename(
            filetypes=(("ПНГ", "*.png"),
                       ("ГИФ", "*.gif"),
                       ("ДЖИПЕГ", "*.jpg"),
                       ("ОСТАЛЬНЫЕ", "*.*"))) 
        txt.insert(0, image)
    else:
        color = colorchooser.askcolor()

window = Tk()
window.title("bg exploit")
window.resizable(width=False, height=False)
window.configure(background='black')

window.iconbitmap(path)

lbl = Label(window, text='Привет, ты нашел секретный exploit по взлому фона рабочего стола\nведи адрес картинки или напиши команду !txtBG\nесли нечего небудет заполнено то выведет текст\n"ПРИВЕТ МИР!!! IT`S BG EXPLOIT :)"', bg="black", fg="white")
lbl.pack()
txt = Entry(window)  
txt.pack()
openFile = Button(window, text="открыть файл", command=openfileClick, bg="black", fg="white")
openFile.pack()
button = Button(window, text="поставить на рабочий стол", command=click, bg="black", fg="white")
button.pack()


window.mainloop()
